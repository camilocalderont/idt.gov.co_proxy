# vhosts_drupal10.conf (Corregido para TU estructura de archivos)

# --- Listener para el Sitio ---
# Define en qué puerto escucha este sitio. Docker lo expondrá al puerto 80 del host.
listener drupal10_http {
  address                 *:80
  secure                  0
  # Mapea las peticiones para los dominios especificados a este Virtual Host.
  map                     drupal10 www.idt.gov.co, idt.gov.co
}

# --- Virtual Host para Drupal 10 ---
# Contenedor de toda la configuración para el dominio.
virtualhost drupal10 {
  # Apunta a la raíz del código de Drupal que montas en el volumen.
  vhRoot                  /var/www/html

  # ✅ CORRECCIÓN: El docRoot es la misma raíz, ya que tu index.php está ahí.
  docRoot                 $vhRoot

  # Dominios que este vhost debe atender.
  vhDomain                www.idt.gov.co
  vhAliases               idt.gov.co
  adminEmails             admin@idt.gov.co

  # Habilitar compresión Gzip para acelerar la carga.
  enableGzip              1

  # --- Manejador de PHP ---
  # Define qué procesador PHP usar.
  scripthandler {
    add                   lsapi:php-litespeed php
  }

  # Define CÓMO ejecutar PHP.
  extprocessor php-litespeed {
    type                  lsapi
    address               uds://tmp/lshttpd/lsphp.sock
    maxConns              50
    env                   PHP_LSAPI_CHILDREN=50
    initTimeout           60
    autoStart             2
    path                  /usr/local/lsws/lsphp83/bin/lsphp
  }

  # --- Lógica de Drupal ---
  # Le dice a LiteSpeed que permita que el archivo .htaccess de Drupal maneje las URLs.
  # Esto es CRUCIAL para que las URLs amigables (ej: /noticias/mi-noticia) funcionen.
  rewrite  {
    enable                  1
    autoLoadHtaccess        1
  }
}